let accounts = [
  {id:1, user:'LeDuck', email:'leduc123@gmail.com', role:'ng∆∞·ªùi mua', status:'Active'},
  {id:2, user:'Tungngu', email:'tung123@gmail.com', role:'ng∆∞·ªùi mua', status:'Active'},
  {id:3, user:'AnChiPu', email:'anchimloi123@gmail.com', role:'ng∆∞·ªùi mua', status:'Active'},
  {id:4, user:'NamDat', email:'nghia123@gmail.com', role:'ng∆∞·ªùi mua', status:'Locked'},
];

const tbody = document.querySelector("#accountTable tbody");
const searchBox = document.getElementById("search");
const modal = document.getElementById("modal");
const modalBody = document.getElementById("modalBody");
const modalTitle = document.getElementById("modalTitle");
const btnSave = document.getElementById("btnSave");

let editingId = null, adding = false;

function renderTable(data) {
  tbody.innerHTML = "";
  data.forEach((acc, idx) => {
    tbody.innerHTML += `
      <tr>
        <td>${idx+1}</td>
        <td>${acc.user}</td>
        <td>${acc.email}</td>
        <td>${acc.role}</td>
        <td><span class="${acc.status==='Active'?'active':'locked'}">${acc.status}</span></td>
        <td>
          <button class="btn btn-detail" onclick="openDetail(${acc.id})">Xem</button>
          <button class="btn btn-edit" onclick="openEdit(${acc.id})">‚úé S·ª≠a</button>
          <button class="btn btn-delete" onclick="deleteAcc(${acc.id})">üóëÔ∏è Xo√°</button>
        </td>
      </tr>
    `;
  });
}
renderTable(accounts);

searchBox.addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  const filtered = accounts.filter(acc => acc.user.toLowerCase().includes(q) || acc.email.toLowerCase().includes(q));
  renderTable(filtered);
});

function openDetail(id) {
  const acc = accounts.find(a=>a.id===id);
  editingId = null; adding = false;
  modalTitle.textContent = "Chi ti·∫øt t√†i kho·∫£n";
  modalBody.innerHTML = `
    <p><b>Username:</b> ${acc.user}</p>
    <p><b>Email:</b> ${acc.email}</p>
    <p><b>Vai tr√≤:</b> ${acc.role}</p>
    <p><b>Tr·∫°ng th√°i:</b> ${acc.status}</p>
  `;
  btnSave.style.display = "none";
  modal.style.display = "flex";
}

function openEdit(id) {
  const acc = accounts.find(a=>a.id===id);
  editingId = id; adding = false;
  modalTitle.textContent = "S·ª≠a t√†i kho·∫£n";
  modalBody.innerHTML = formHtml(acc);
  btnSave.style.display = "inline-block";
  modal.style.display = "flex";
}

function openAdd() {
  editingId = null; adding = true;
  modalTitle.textContent = "Th√™m t√†i kho·∫£n";
  modalBody.innerHTML = formHtml();
  btnSave.style.display = "inline-block";
  modal.style.display = "flex";
}

function formHtml(acc={user:"",email:"",role:"",status:"Active"}) {
  return `
    <label>Username</label>
    <input type="text" id="editUser" value="${acc.user}">
    <label>Email</label>
    <input type="email" id="editEmail" value="${acc.email}">
    <label>Vai tr√≤</label>
    <input type="text" id="editRole" value="${acc.role}">
    <label>Tr·∫°ng th√°i</label>
    <select id="editStatus">
      <option ${acc.status==='Active'?'selected':''}>Active</option>
      <option ${acc.status==='Locked'?'selected':''}>Locked</option>
    </select>
  `;
}

function saveEdit() {
  const user = document.getElementById("editUser").value.trim();
  const email = document.getElementById("editEmail").value.trim();
  const role = document.getElementById("editRole").value.trim();
  const status = document.getElementById("editStatus").value;
  if(!user || !email || !role){ alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!"); return; }
  if(adding){
    const newId = accounts.length? Math.max(...accounts.map(a=>a.id))+1:1;
    accounts.push({id:newId,user,email,role,status});
  }else if(editingId){
    const acc = accounts.find(a=>a.id===editingId);
    acc.user = user; acc.email=email; acc.role=role; acc.status=status;
  }
  renderTable(accounts);
  closeModal();
}

function deleteAcc(id) {
  if(confirm("B·∫°n c√≥ ch·∫Øc mu·ªën xo√° t√†i kho·∫£n n√†y?")){
    accounts = accounts.filter(a=>a.id!==id);
    renderTable(accounts);
  }
}

function closeModal() {
  modal.style.display = "none";
}
